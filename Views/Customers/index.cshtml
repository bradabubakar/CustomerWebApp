@{
    ViewBag.Title = "Customers";
    Layout = "~/Views/shared/_Layout.cshtml";
}

<script src="~/lib/jquery/dist/jquery.min.js"></script>

<h2> Add a Customer</h2>
<div class="form-group" style="display:none;">
    <input id="txtCustomerId" class="form-control" name="id" />
</div>
<div class="form-group">
    <label for="firstname">Firstname</label>
    <input id="txtFirstname" class="form-control" name="firstname" />
</div>
<div class="form-group">
    <label for="lastname">Lastname</label>
    <input id="txtLastname" class="form-control" name="lastname" />
</div>
<div class="text-center panel-body">
    <button id="btnSave" class="btn btn-sm btn-primary">Save</button>
</div>

<button onclick="GetAllCustomers()" class="btn btn-primary">Get Customers</button>

<br/>

<h2>Customer List</h2>
<table id="tblCustomer" class="table table-sm table-striped table-bordered m-2">
    <thead>
        <tr>
            <th>Id</th>
            <th>Firstname</th>
            <th>Lastname</th>
        </tr>
    </thead>
<tbody></tbody>

</table>

<script type="text/javascript">
    $(document).ready(function () {

    });

    function GetAllCustomers() {
        $.getJSON("/Customers/GetAllCustomers", function (customers) {
           // console.log(customers);
            $("#tblCustomer tbody tr").remove();
           // $.map(customers, function (customer) {
             $.each(customers, function (i, customer) {
              //  console.log(customer.id);
                $("#tblCustomer tbody").append("<tr>"
                    + " <td>" + customer.id + "</td>"
                    + " <td>" + customer.firstname + "</td>"
                    + " <td>" + customer.lastname + "</td>"
                    + " <td>"
                    + "     <button class='btn-success' onclick='Edit(" + customer.id + ")' style='margin-right:5px;'>Edit</button>"
                    + "     <button class='btn-danger' onclick='Delete(" + customer.id + ")'>Delete</button>"
                    + " </td> "
                    + " </tr>");
                });
            });
    }

    function Edit(customerId) {
        if (customerId > 0) {
            $.getJSON("/Customers/GetById?CustomerId=" + customerId, function (customer) {
                $("#txtCustomerId").val(customer.id);
                $("#txtFirstname").val(customer.firstname);
                $("#txtLastname").val(customer.lastname);
            });
        }
    }

     function Delete(customerId) {
        if (customerId > 0) {
            $.ajax({
                url: '/Customers/Delete?customerId=' + customerId,
                type: 'DELETE',
                dataType: 'json',
                success: function (data) {
                },
                error: function (ex) {
                    console.log('Error found!');
                }
            });
        }
    }

    $("#btnSave").click(function () {
        var oCustomer = {
            id: $("#txtCustomerId").val(),
            firstname: $("#txtFirstname").val(),
            lastname: $("#txtLastname").val()
        };

        $.post("/Customers/AddUpdateCustomer", oCustomer)
            .done(function (data) {
                GetAllCustomers
            });

        GetAllCustomers()
    });

</script>
